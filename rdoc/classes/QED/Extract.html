<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

  <title>Module: QED::Extract</title>

  
    <link rel="SHORTCUT ICON" href="../../assets/icon/module.png">
  

  <link type="text/css" rel="stylesheet" href="../../assets/rdoc.css" media="screen" />
  <link type="text/css" rel="stylesheet" href="../../assets/highlight/styles/github.css" title="GitHub" />

  <script type="text/javascript" charset="utf-8" src="../../assets/jquery.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../assets/highlight/highlight.pack.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../assets/quicksearch.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../assets/main.js"></script>

  <script type="text/javascript">
    $(document).ready( function() {
      hookHighlightSyntax();
	    hookSourceViews();
	    hookDebuggingToggle();
	    hookQuickSearch();
	    highlightLocationTarget();

	    $('ul.link-list a').bind("click", highlightClickTarget);
    });
  </script>
</head>
<body class="module">
<div id="main">

  <div class="head">
    <h1>
      
        <img src="../../assets/icon/module.png" align="absmiddle">&nbsp;
      
      <a href="../../index.html">Qed</a>&nbsp;
      <a href="/">QED::Extract</a>
    </h1>
  </div>

  <div id="metadata">
    <div id="project-metadata">

      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li class="file"><a href="../../files/lib/qed/extract_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/qed/extract.rb">lib/qed/extract.rb</a></li>
          
          </ul>
        </div>
      </div>

      <!-- What about Git info, or Hg info? This seems almost silly, albeit kind of cool. -->
      <!-- TODO: generalize this for all SCMs -->

      
    </div>

    <div id="class-metadata">

      <!-- Parent Class -->
      

      <!-- Namespace Contents -->
      

      <!-- Method Quickref -->
      
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
            
            <li class="method">
              <a href="#M000031">#create_test</a>
            </li>
          
            
            <li class="method">
              <a href="#M000029">#extract_test_from_file</a>
            </li>
          
            
            <li class="method">
              <a href="#M000022">#test_extract</a>
            </li>
          
        </ul>
      </div>
      

      <!-- Included Modules -->
      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Information</h3>
        <ul>
        
          <li class="file"><a href="../../files/lib/qed/document/template_rhtml.html">template.rhtml</a></li>
        
          <li class="file"><a href="../../files/HISTORY.html">HISTORY</a></li>
        
          <li class="file"><a href="../../files/Syckfile.html">Syckfile</a></li>
        
          <li class="file"><a href="../../files/COPYING.html">COPYING</a></li>
        
          <li class="file"><a href="../../files/lib/qed/document/jquery_js.html">jquery.js</a></li>
        
          <li class="file"><a href="../../files/README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="../../assets/icon/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <!-- classpage.html : classes -->
        <ul class="link-list">
        
          <li class="module"><a href="../../classes/QED.html">QED</a></li>
        
          <li class="class"><a href="../../classes/QED/Command.html">QED::Command</a></li>
        
          <li class="class"><a href="../../classes/QED/Config.html">QED::Config</a></li>
        
          <li class="class"><a href="../../classes/QED/Context.html">QED::Context</a></li>
        
          <li class="class"><a href="../../classes/QED/Document.html">QED::Document</a></li>
        
          <li class="class"><a href="../../classes/QED/Document/Markup.html">QED::Document::Markup</a></li>
        
          <li class="class"><a href="../../classes/QED/Document/Markup/ToHTML.html">QED::Document::Markup::ToHTML</a></li>
        
          <li class="module"><a href="../../classes/QED/Extract.html">QED::Extract</a></li>
        
          <li class="class"><a href="../../classes/QED/Reporter/BaseClass.html">QED::Reporter::BaseClass</a></li>
        
          <li class="class"><a href="../../classes/QED/Reporter/Ditto.html">QED::Reporter::Ditto</a></li>
        
          <li class="class"><a href="../../classes/QED/Reporter/DotProgress.html">QED::Reporter::DotProgress</a></li>
        
          <li class="class"><a href="../../classes/QED/Reporter/Summary.html">QED::Reporter::Summary</a></li>
        
          <li class="class"><a href="../../classes/QED/Reporter/Verbatim.html">QED::Reporter::Verbatim</a></li>
        
          <li class="class"><a href="../../classes/QED/Runner.html">QED::Runner</a></li>
        
          <li class="class"><a href="../../classes/QED/Script.html">QED::Script</a></li>
        
          <li class="class"><a href="../../classes/QED/Script/Code.html">QED::Script::Code</a></li>
        
          <li class="class"><a href="../../classes/QED/Script/Head.html">QED::Script::Head</a></li>
        
          <li class="class"><a href="../../classes/QED/Script/Text.html">QED::Script::Text</a></li>
        
          <li class="class"><a href="../../classes/QED/Template.html">QED::Template</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>
    </div>

    <div id="validator-badges">
      
      <div style="float: right; margin-right: 5px;">
        <a href="http://validator.w3.org/check/referer"><img src="../../assets/icon/check.png" alt="[Validate]" height="16" width="16" /></a>
      </div>
      Generated with <a href="http://github.com/proutils/webri">WebRI Redfish</a> 1.1
      <br/><br/>
    </div>
  </div>

  <div id="documentation">

    <div id="description">
      
        <h1>Extract</h1>
      

      <p>
Extractor is a tool for extracting code from embedded comment blocks.
</p>
<p>
TODO:
</p>
<pre>
  - Should extract_block handle more than the first matching block?
  - How can we handle embedded code in standard comments? Eg. #
</pre>

    </div>

    <!-- Constants -->
    

    <!-- Attributes -->
    

    <!-- Methods -->
    
    <div id="public-instance-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="test-extract-method" class="method-detail ">
        <a name="M000022"></a>

        <div class="method-heading">
        
          <span class="method-name">test_extract</span><span
            class="method-args">(files=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
<a href="Extract.html">Extract</a> unit tests. This task scans every
package script looking for sections of the form:
</p>
<pre>
    =begin test
      ...
    =end
</pre>
<p>
With appropriate headers, it copies these sections to files in your
project&#8217;s test/ dir, which then can be run using the Ratchet test
task. The exact directory layout of the files to be tested is reflected in
the test directory. You can then use project.rb&#8217;s test task to run
the tests.
</p>
<pre>
    files      Files to extract ['lib/**/*.rb']
    output     Test directory   ['test/']
</pre>
          

          
          <div class="method-source-code"
            id="test-extract-source">
<pre>
<span class="ruby-comment cmt"># File lib/qed/extract.rb, line 35</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_extract</span>(<span class="ruby-identifier">files</span>=<span class="ruby-keyword kw">nil</span>)
      <span class="ruby-identifier">output</span> = <span class="ruby-value str">'test/embedded'</span>     <span class="ruby-comment cmt"># Don't think output should be setable.</span>

      <span class="ruby-identifier">files</span>  = <span class="ruby-identifier">files</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'lib/**/*.rb'</span>
      <span class="ruby-identifier">files</span> = <span class="ruby-value str">'lib/**/*.rb'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TrueClass</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">files</span>
      <span class="ruby-identifier">files</span> = [<span class="ruby-identifier">files</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>

      <span class="ruby-identifier">filelist</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">collect</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">f</span>) }
      <span class="ruby-identifier">filelist</span>.<span class="ruby-identifier">flatten!</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filelist</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;No scripts found from which to extract tests.&quot;</span>
        <span class="ruby-keyword kw">return</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">output</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">output</span>)

      <span class="ruby-comment cmt">#vrunner = VerbosityRunner.new(&quot;Extracting&quot;, verbosity?)</span>
      <span class="ruby-comment cmt">#vrunner.setup(filelist.size)</span>

      <span class="ruby-identifier">filelist</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
        <span class="ruby-comment cmt">#vrunner.prepare(file)</span>

        <span class="ruby-identifier">testing</span> = <span class="ruby-identifier">extract_test_from_file</span>( <span class="ruby-identifier">file</span> )
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">testing</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">status</span> = <span class="ruby-value str">&quot;[NONE]&quot;</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">complete_test</span> = <span class="ruby-identifier">create_test</span>(<span class="ruby-identifier">testing</span>, <span class="ruby-identifier">file</span>)
          <span class="ruby-identifier">libpath</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">file</span>)
          <span class="ruby-identifier">testfile</span> = <span class="ruby-value str">&quot;test_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">file</span>)
          <span class="ruby-identifier">fp</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">output</span>, <span class="ruby-identifier">libpath</span>, <span class="ruby-identifier">testfile</span>)
          <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>( <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">fp</span>))
            <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">fp</span>))
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">fp</span>, <span class="ruby-value str">&quot;w&quot;</span>){ <span class="ruby-operator">|</span><span class="ruby-identifier">fw</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fw</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">complete_test</span> }
          <span class="ruby-identifier">status</span> = <span class="ruby-value str">&quot;[TEST]&quot;</span>
        <span class="ruby-keyword kw">end</span>

        <span class="ruby-comment cmt">#vrunner.complete(file, status)</span>
      <span class="ruby-keyword kw">end</span>

      <span class="ruby-comment cmt">#vrunner.finish(</span>
      <span class="ruby-comment cmt">#  :normal =&gt; &quot;#{filelist.size} files had tests extracted.&quot;,</span>
      <span class="ruby-comment cmt">#  :check =&gt; false</span>
      <span class="ruby-comment cmt">#)</span>
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  
    <div id="private-instance-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="create-test-method" class="method-detail ">
        <a name="M000031"></a>

        <div class="method-heading">
        
          <span class="method-name">create_test</span><span
            class="method-args">(testing, file)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Generate the test.
</p>
          

          
          <div class="method-source-code"
            id="create-test-source">
<pre>
<span class="ruby-comment cmt"># File lib/qed/extract.rb, line 107</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_test</span>(<span class="ruby-identifier">testing</span>, <span class="ruby-identifier">file</span>)
      <span class="ruby-identifier">fp</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/[\/]/</span>)
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fp</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'lib'</span>
        <span class="ruby-identifier">reqf</span> = <span class="ruby-node">&quot;require '#{fp[1..-1].join('/')}'&quot;</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">reqf</span> = <span class="ruby-value str">''</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">teststr</span> = []
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;#  _____         _&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;# |_   _|__  ___| |_&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;#   | |/ _ \\/ __| __|&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;#   | |  __/\\__ \\ |_&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;#   |_|\\___||___/\\__|&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;#&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;# for #{file}&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;#&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;# Extracted #{Time.now}&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;# Project.rb Test Extraction&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;#&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{reqf}&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&quot;</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">testing</span>
      <span class="ruby-identifier">teststr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;&quot;</span>
      <span class="ruby-identifier">teststr</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="extract-test-from-file-method" class="method-detail ">
        <a name="M000029"></a>

        <div class="method-heading">
        
          <span class="method-name">extract_test_from_file</span><span
            class="method-args">(file)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
<a href="Extract.html">Extract</a> test from a file&#8217;s testing
comments.
</p>
          

          
          <div class="method-source-code"
            id="extract-test-from-file-source">
<pre>
<span class="ruby-comment cmt"># File lib/qed/extract.rb, line 85</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extract_test_from_file</span>(<span class="ruby-identifier">file</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">file</span>)
      <span class="ruby-identifier">tests</span> = <span class="ruby-value str">&quot;&quot;</span>; <span class="ruby-identifier">inside</span> = <span class="ruby-keyword kw">false</span>
      <span class="ruby-identifier">fstr</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">file</span>)
      <span class="ruby-identifier">fstr</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\n/</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">l</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^=begin[ ]*test/i</span>
          <span class="ruby-identifier">tests</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
          <span class="ruby-identifier">inside</span> = <span class="ruby-keyword kw">true</span>
          <span class="ruby-keyword kw">next</span>
        <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">inside</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">l</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^=[ ]*end/</span>
          <span class="ruby-identifier">inside</span> = <span class="ruby-keyword kw">false</span>
          <span class="ruby-keyword kw">next</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">inside</span>
          <span class="ruby-identifier">tests</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">l</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">tests</span>
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  

  </div>


  <div id="rdoc-debugging-section-dump" class="debugging-section">
  
    <p>Disabled; run with --debug to generate this.</p>
  
  </div>

</main>
</body>
</html>

